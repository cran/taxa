<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Scott Chamberlain and Zachary Foster" />

<meta name="date" content="2020-02-24" />

<title>Introduction to the taxa package</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to the taxa package</h1>
<h4 class="author">Scott Chamberlain and Zachary Foster</h4>
<h4 class="date">2020-02-24</h4>



<p><code>taxa</code> defines taxonomic classes and functions to manipulate them. The goal is to use these classes as low level fundamental taxonomic classes that other R packages can build on and supply robust manipulation functions (e.g. subsetting) that are broadly useful.</p>
<p>There are two distinct types of classes in <code>taxa</code>:</p>
<ul>
<li>Classes that are concerned only with taxonomic information: <code>taxon</code>, <code>taxonomy</code>, <code>hierarchy</code>, etc.</li>
<li>A class called <code>taxmap</code> that is concerned with combining taxonomic data with user-defined data of any type (e.g. molecular sequences, abundance counts etc.)</li>
</ul>
<p>Diagram of class concepts for <code>taxa</code> classes:</p>
<p>Relationship between classes implemented in the taxa package. Diamond-tipped arrows indicate that objects of one class are used in another class. For example, a database object can stored in the taxon_rank, taxon_name, or taxon_id objects. A standard arrow indicates inheritance. For example, the taxmap class inherits the taxonomy class. <code>*</code> means that the object (e.g. a database object) can be replaced by a simple character vector. <code>?</code> means that the data is optional (Note: being able to replace objects with characters might be going away soon).</p>
<div id="install" class="section level2">
<h2>Install</h2>
<p>For the latest “stable” release, use the CRAN version:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;taxa&quot;</span>)</a></code></pre></div>
<p>For all the latest improvements, bug fixes, and bugs, you can download the development version:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;ropensci/taxa&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;taxa&quot;</span>)</a></code></pre></div>
</div>
<div id="the-classes" class="section level2">
<h2>The classes</h2>
<div id="minor-component-classes" class="section level3">
<h3>Minor component classes</h3>
<p>There are a few optional classes used to store information in other classes. These will probably mostly be of interest to developers rather than users.</p>
<div id="database" class="section level4">
<h4>database</h4>
<p>Taxonomic data usually comes from a database. A common example is the <a href="https://www.ncbi.nlm.nih.gov/taxonomy">NCBI Taxonomy Database</a> used to provide taxonomic classifications to sequences deposited in <a href="https://www.ncbi.nlm.nih.gov/guide/all/">other NCBI databases</a>. The <code>database</code> class stores the name of the database and associated information:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">(ncbi &lt;-<span class="st"> </span><span class="kw">taxon_database</span>(</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="dt">name =</span> <span class="st">&quot;ncbi&quot;</span>,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">url =</span> <span class="st">&quot;http://www.ncbi.nlm.nih.gov/taxonomy&quot;</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">description =</span> <span class="st">&quot;NCBI Taxonomy Database&quot;</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="dt">id_regex =</span> <span class="st">&quot;*&quot;</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">))</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">ncbi<span class="op">$</span>name</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">ncbi<span class="op">$</span>url</a></code></pre></div>
<p>To save on memory, a selection of common databases is provided with the package (<code>database_list</code>) and any in this list can be used by name instead of making a new database object (e.g. <code>&quot;ncbi&quot;</code> instead of the <code>ncbi</code> above).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">database_list</a></code></pre></div>
</div>
<div id="rank" class="section level4">
<h4>rank</h4>
<p>Taxa might have defined ranks (e.g. species, family, etc.), ambiguous ranks (e.g. “unranked”, “unknown”), or no rank information at all. The particular selection and format of valid ranks varies with database, so the database can be optionally defined. If no database is defined, any ranks in any order are allowed.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">taxon_rank</span>(<span class="dt">name =</span> <span class="st">&quot;species&quot;</span>, <span class="dt">database =</span> <span class="st">&quot;ncbi&quot;</span>)</a></code></pre></div>
</div>
<div id="taxon_name" class="section level4">
<h4><code>taxon_name</code></h4>
<p>The taxon name can be defined in the same way as rank.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">taxon_name</span>(<span class="st">&quot;Poa&quot;</span>, <span class="dt">database =</span> <span class="st">&quot;ncbi&quot;</span>)</a></code></pre></div>
</div>
<div id="taxon_id" class="section level4">
<h4>taxon_id</h4>
<p>Each database has its set of unique taxon IDs. These IDs are better than using the taxon name directly because they are guaranteed to be unique, whereas there are often duplicates of taxon names (e.g. <em>Orestias elegans</em> is the name of both an orchid and a fish).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">taxon_id</span>(<span class="dv">12345</span>, <span class="dt">database =</span> <span class="st">&quot;ncbi&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="the-taxon-class" class="section level3">
<h3>The “taxon” class</h3>
<p>The <code>taxon</code> class combines the classes containing the name, rank, and ID for the taxon. There is also a place to define an authority of the taxon.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">(x &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Poa annua&quot;</span>),</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;species&quot;</span>),</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">93036</span>),</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">authority =</span> <span class="st">&quot;Linnaeus&quot;</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">))</a></code></pre></div>
<p>Instead of the name, rank, and ID classes, simple character vectors can be supplied. These will be converted to objects automatically.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">(x &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="dt">name =</span> <span class="st">&quot;Poa annua&quot;</span>,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="dt">rank =</span> <span class="st">&quot;species&quot;</span>,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">  <span class="dt">id =</span> <span class="dv">93036</span>,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">  <span class="dt">authority =</span> <span class="st">&quot;Linnaeus&quot;</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">))</a></code></pre></div>
<p>The <code>taxa</code> class is just a list of <code>taxon</code> classes. It is meant to store an arbitrary list of <code>taxon</code> objects.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">grass &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Poa annua&quot;</span>),</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;species&quot;</span>),</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">93036</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">mammalia &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Mammalia&quot;</span>),</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;class&quot;</span>),</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">9681</span>)</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">plantae &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Plantae&quot;</span>),</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;kingdom&quot;</span>),</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">33090</span>)</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="kw">taxa</span>(grass, mammalia, plantae)</a></code></pre></div>
</div>
<div id="the-hierarchy-class" class="section level3">
<h3>The “hierarchy” class</h3>
<p><a href="https://en.wikipedia.org/wiki/Taxonomy_(biology)#Classifying_organisms">Taxonomic classifications</a> are an ordered set of taxa, each at a different rank. The <code>hierarchy</code> class stores a list of <code>taxon</code> classes like <code>taxa</code>, but <code>hierarchy</code> is meant to store all of the taxa in a classification in the correct order.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Poaceae&quot;</span>),</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;family&quot;</span>),</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">4479</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">y &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Poa&quot;</span>),</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;genus&quot;</span>),</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">4544</span>)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb12-12" data-line-number="12"></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">z &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Poa annua&quot;</span>),</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;species&quot;</span>),</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">93036</span>)</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">)</a>
<a class="sourceLine" id="cb12-18" data-line-number="18"></a>
<a class="sourceLine" id="cb12-19" data-line-number="19">(hier1 &lt;-<span class="st"> </span><span class="kw">hierarchy</span>(z, y, x))</a></code></pre></div>
<p>Multiple <code>hierarchy</code> classes are stored in the <code>hierarchies</code> class, similar to how multiple <code>taxon</code> are stored in <code>taxa</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Felidae&quot;</span>),</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;family&quot;</span>),</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">9681</span>)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">b &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Puma&quot;</span>),</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;genus&quot;</span>),</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">146712</span>)</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">c &lt;-<span class="st"> </span><span class="kw">taxon</span>(</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">  <span class="dt">name =</span> <span class="kw">taxon_name</span>(<span class="st">&quot;Puma concolor&quot;</span>),</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">  <span class="dt">rank =</span> <span class="kw">taxon_rank</span>(<span class="st">&quot;species&quot;</span>),</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">  <span class="dt">id =</span> <span class="kw">taxon_id</span>(<span class="dv">9696</span>)</a>
<a class="sourceLine" id="cb13-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb13-16" data-line-number="16">(hier2 &lt;-<span class="st"> </span><span class="kw">hierarchy</span>(c, b, a))</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">hierarchies</span>(hier1, hier2)</a></code></pre></div>
</div>
<div id="the-taxonomy-class" class="section level3">
<h3>The “taxonomy” class</h3>
<p>The <code>taxonomy</code> class stores unique <code>taxon</code> objects in a tree structure. Usually this kind of complex information would be the output of a file parsing function, but the code below shows how to construct a <code>taxonomy</code> object from scratch (you would not normally do this).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># define taxa</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">notoryctidae &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Notoryctidae&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;family&quot;</span>, <span class="dt">id =</span> <span class="dv">4479</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">notoryctes &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Notoryctes&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;genus&quot;</span>, <span class="dt">id =</span> <span class="dv">4544</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">typhlops &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;typhlops&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;species&quot;</span>, <span class="dt">id =</span> <span class="dv">93036</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">mammalia &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Mammalia&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;class&quot;</span>, <span class="dt">id =</span> <span class="dv">9681</span>)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">felidae &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Felidae&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;family&quot;</span>, <span class="dt">id =</span> <span class="dv">9681</span>)</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">felis &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Felis&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;genus&quot;</span>, <span class="dt">id =</span> <span class="dv">9682</span>)</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">catus &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;catus&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;species&quot;</span>, <span class="dt">id =</span> <span class="dv">9685</span>)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">panthera &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Panthera&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;genus&quot;</span>, <span class="dt">id =</span> <span class="dv">146712</span>)</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">tigris &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;tigris&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;species&quot;</span>, <span class="dt">id =</span> <span class="dv">9696</span>)</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">plantae &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Plantae&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;kingdom&quot;</span>, <span class="dt">id =</span> <span class="dv">33090</span>)</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">solanaceae &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Solanaceae&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;family&quot;</span>, <span class="dt">id =</span> <span class="dv">4070</span>)</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">solanum &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Solanum&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;genus&quot;</span>, <span class="dt">id =</span> <span class="dv">4107</span>)</a>
<a class="sourceLine" id="cb15-14" data-line-number="14">lycopersicum &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;lycopersicum&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;species&quot;</span>, <span class="dt">id =</span> <span class="dv">49274</span>)</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">tuberosum &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;tuberosum&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;species&quot;</span>, <span class="dt">id =</span> <span class="dv">4113</span>)</a>
<a class="sourceLine" id="cb15-16" data-line-number="16">homo &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;homo&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;genus&quot;</span>, <span class="dt">id =</span> <span class="dv">9605</span>)</a>
<a class="sourceLine" id="cb15-17" data-line-number="17">sapiens &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;sapiens&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;species&quot;</span>, <span class="dt">id =</span> <span class="dv">9606</span>)</a>
<a class="sourceLine" id="cb15-18" data-line-number="18">hominidae &lt;-<span class="st"> </span><span class="kw">taxon</span>(<span class="dt">name =</span> <span class="st">&quot;Hominidae&quot;</span>, <span class="dt">rank =</span> <span class="st">&quot;family&quot;</span>, <span class="dt">id =</span> <span class="dv">9604</span>)</a>
<a class="sourceLine" id="cb15-19" data-line-number="19"></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"><span class="co"># define hierarchies</span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21">tiger &lt;-<span class="st"> </span><span class="kw">hierarchy</span>(mammalia, felidae, panthera, tigris)</a>
<a class="sourceLine" id="cb15-22" data-line-number="22">cat &lt;-<span class="st"> </span><span class="kw">hierarchy</span>(mammalia, felidae, felis, catus)</a>
<a class="sourceLine" id="cb15-23" data-line-number="23">human &lt;-<span class="st"> </span><span class="kw">hierarchy</span>(mammalia, hominidae, homo, sapiens)</a>
<a class="sourceLine" id="cb15-24" data-line-number="24">mole &lt;-<span class="st"> </span><span class="kw">hierarchy</span>(mammalia, notoryctidae, notoryctes, typhlops)</a>
<a class="sourceLine" id="cb15-25" data-line-number="25">tomato &lt;-<span class="st"> </span><span class="kw">hierarchy</span>(plantae, solanaceae, solanum, lycopersicum)</a>
<a class="sourceLine" id="cb15-26" data-line-number="26">potato &lt;-<span class="st"> </span><span class="kw">hierarchy</span>(plantae, solanaceae, solanum, tuberosum)</a>
<a class="sourceLine" id="cb15-27" data-line-number="27"></a>
<a class="sourceLine" id="cb15-28" data-line-number="28"><span class="co"># make taxonomy</span></a>
<a class="sourceLine" id="cb15-29" data-line-number="29">(tax &lt;-<span class="st"> </span><span class="kw">taxonomy</span>(tiger, cat, human, tomato, potato))</a></code></pre></div>
<p>Unlike the <code>hierarchies</code> class, each unique <code>taxon</code> object is only represented once in the <code>taxonomy</code> object. Each taxon has a corresponding entry in an <a href="https://en.wikipedia.org/wiki/Adjacency_list">edge list</a> that encode how it is related to other taxa. This makes <code>taxonomy</code> more compact, but harder to manipulate using standard indexing. To make manipulation easier, there are functions like <code>filter_taxa</code> and <code>subtaxa</code> that will be covered later. In general, the <code>taxonomy</code> and <code>taxmap</code> objects (covered later) would be instantiated using a parser like <code>parse_tax_data</code>. This is covered in detail in the parsing vignette.</p>
<div id="supertaxa" class="section level4">
<h4>supertaxa</h4>
<p>A “supertaxon” is a taxon of a coarser rank that encompasses the taxon of interest (e.g. “Homo” is a supertaxon of “sapiens”). The <code>supertaxa</code> function returns the supertaxa of all or a subset of the taxa in a <code>taxonomy</code> object.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">supertaxa</span>(tax)</a></code></pre></div>
<p>By default, the taxon IDs for the supertaxa of all taxa are returned in the same order they appear in the edge list. Taxon IDs (character) or edge list indexes (integer) can be supplied to the <code>subset</code> option to only return information for some taxa.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">supertaxa</span>(tax, <span class="dt">subset =</span> <span class="st">&quot;m&quot;</span>)</a></code></pre></div>
<p>What is returned can be modified with the <code>value</code> option:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">supertaxa</span>(tax, <span class="dt">subset =</span> <span class="st">&quot;m&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;taxon_names&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">supertaxa</span>(tax, <span class="dt">subset =</span> <span class="st">&quot;m&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;taxon_ranks&quot;</span>)</a></code></pre></div>
<p>You can also subset based on a logical test:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">supertaxa</span>(tax, <span class="dt">subset =</span> taxon_ranks <span class="op">==</span><span class="st"> &quot;genus&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;taxon_ranks&quot;</span>)</a></code></pre></div>
<p>The <code>subset</code> and <code>value</code> work the same for most of the following functions as well. See <code>all_names(tax)</code> for what can be used with <code>value</code> and <code>subset</code>. Note how <code>value</code> takes a character vector (<code>&quot;taxon_ranks&quot;</code>), but <code>subset</code> can use the same value (<code>taxon_ranks</code>) as a part of an expression. <code>taxon_ranks</code> is actually a function that is run automatically when its name is used this way:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">taxon_ranks</span>(tax)</a></code></pre></div>
<p>This is an example of <a href="http://adv-r.had.co.nz/Computing-on-the-language.html">Non-standard evaluation</a> (NSE). NSE makes codes easier to read an write. The call to <code>supertaxa</code> could also have been written without NSE like so:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">supertaxa</span>(tax, <span class="dt">subset =</span> <span class="kw">taxon_ranks</span>(tax) <span class="op">==</span><span class="st"> &quot;genus&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;taxon_ranks&quot;</span>)</a></code></pre></div>
</div>
<div id="subtaxa" class="section level4">
<h4>subtaxa</h4>
<p>The “subtaxa” of a taxon are all those of a finer rank encompassed by that taxon. For example, <em>sapiens</em> is a subtaxon of <em>Homo</em>. The <code>subtaxa</code> function returns all subtaxa for each taxon in a <code>taxonomy</code> object.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">subtaxa</span>(tax, <span class="dt">value =</span> <span class="st">&quot;taxon_names&quot;</span>)</a></code></pre></div>
<p>This and the following functions behaves much like <code>supertaxa</code>, so we will not go into the same details here.</p>
</div>
<div id="roots" class="section level4">
<h4>roots</h4>
<p>We call taxa that have no supertaxa “roots”. The <code>roots</code> function returns these taxa.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">roots</span>(tax, <span class="dt">value =</span> <span class="st">&quot;taxon_names&quot;</span>)</a></code></pre></div>
</div>
<div id="leaves" class="section level4">
<h4>leaves</h4>
<p>We call taxa without any subtaxa “leaves”. The <code>leaves</code> function returns these taxa.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">leaves</span>(tax, <span class="dt">value =</span> <span class="st">&quot;taxon_names&quot;</span>)</a></code></pre></div>
</div>
<div id="other-functions" class="section level4">
<h4>other functions</h4>
<p>There are many other functions to interact with <code>taxonomy</code> object, such as <code>stems</code> and <code>n_subtaxa</code>, but these will not be described here for now.</p>
</div>
</div>
<div id="the-taxmap-class" class="section level3">
<h3>The “taxmap” class</h3>
<p>The <code>taxmap</code> class is used to store any number of tables, lists, or vectors associated with taxa. It is basically the same as the <code>taxonomy</code> class, but with the following additions:</p>
<ul>
<li>A list called <code>data</code> that stores arbitrary user data associated with taxa</li>
<li>A list called <code>funcs</code> that stores user defined functions</li>
</ul>
<p>All the functions described above for the <code>taxonomy</code> class can be used with the <code>taxmap</code> class.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">info &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;tiger&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;mole&quot;</span>, <span class="st">&quot;human&quot;</span>, <span class="st">&quot;tomato&quot;</span>, <span class="st">&quot;potato&quot;</span>),</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">                   <span class="dt">n_legs =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">                   <span class="dt">dangerous =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">phylopic_ids &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;e148eabb-f138-43c6-b1e4-5cda2180485a&quot;</span>,</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">                  <span class="st">&quot;12899ba0-9923-4feb-a7f9-758c3c7d5e13&quot;</span>,</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">                  <span class="st">&quot;11b783d5-af1c-4f4e-8ab5-a51470652b47&quot;</span>,</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">                  <span class="st">&quot;9fae30cd-fb59-4a81-a39c-e1826a35f612&quot;</span>,</a>
<a class="sourceLine" id="cb26-9" data-line-number="9">                  <span class="st">&quot;b6400f39-345a-4711-ab4f-92fd4e22cb1a&quot;</span>,</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">                  <span class="st">&quot;63604565-0406-460b-8cb8-1abe954b3f3a&quot;</span>)</a>
<a class="sourceLine" id="cb26-11" data-line-number="11"></a>
<a class="sourceLine" id="cb26-12" data-line-number="12">foods &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;mammals&quot;</span>, <span class="st">&quot;birds&quot;</span>),</a>
<a class="sourceLine" id="cb26-13" data-line-number="13">              <span class="kw">c</span>(<span class="st">&quot;cat food&quot;</span>, <span class="st">&quot;mice&quot;</span>),</a>
<a class="sourceLine" id="cb26-14" data-line-number="14">              <span class="kw">c</span>(<span class="st">&quot;insects&quot;</span>),</a>
<a class="sourceLine" id="cb26-15" data-line-number="15">              <span class="kw">c</span>(<span class="st">&quot;Most things, but especially anything rare or expensive&quot;</span>),</a>
<a class="sourceLine" id="cb26-16" data-line-number="16">              <span class="kw">c</span>(<span class="st">&quot;light&quot;</span>, <span class="st">&quot;dirt&quot;</span>),</a>
<a class="sourceLine" id="cb26-17" data-line-number="17">              <span class="kw">c</span>(<span class="st">&quot;light&quot;</span>, <span class="st">&quot;dirt&quot;</span>))</a>
<a class="sourceLine" id="cb26-18" data-line-number="18"></a>
<a class="sourceLine" id="cb26-19" data-line-number="19">reaction &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb26-20" data-line-number="20">  <span class="kw">ifelse</span>(x<span class="op">$</span>data<span class="op">$</span>info<span class="op">$</span>dangerous,</a>
<a class="sourceLine" id="cb26-21" data-line-number="21">         <span class="kw">paste0</span>(<span class="st">&quot;Watch out! That &quot;</span>, x<span class="op">$</span>data<span class="op">$</span>info<span class="op">$</span>name, <span class="st">&quot; might attack!&quot;</span>),</a>
<a class="sourceLine" id="cb26-22" data-line-number="22">         <span class="kw">paste0</span>(<span class="st">&quot;No worries; its just a &quot;</span>, x<span class="op">$</span>data<span class="op">$</span>info<span class="op">$</span>name, <span class="st">&quot;.&quot;</span>))</a>
<a class="sourceLine" id="cb26-23" data-line-number="23">}</a>
<a class="sourceLine" id="cb26-24" data-line-number="24"></a>
<a class="sourceLine" id="cb26-25" data-line-number="25">my_taxmap &lt;-<span class="st"> </span><span class="kw">taxmap</span>(tiger, cat, mole, human, tomato, potato,</a>
<a class="sourceLine" id="cb26-26" data-line-number="26">                    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">info =</span> info,</a>
<a class="sourceLine" id="cb26-27" data-line-number="27">                                <span class="dt">phylopic_ids =</span> phylopic_ids,</a>
<a class="sourceLine" id="cb26-28" data-line-number="28">                                <span class="dt">foods =</span> foods),</a>
<a class="sourceLine" id="cb26-29" data-line-number="29">                    <span class="dt">funcs =</span> <span class="kw">list</span>(<span class="dt">reaction =</span> reaction))</a></code></pre></div>
<p>In most functions that work with taxmap objects, the names of list/vector data sets, table columns, or functions can be used as if they were separate variables on their own (i.e. NSE). In the case of functions, instead of returning the function itself, the results of the functions are returned. To see what variables can be used this way, use <code>all_names</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">all_names</span>(my_taxmap)</a></code></pre></div>
<p>For example using <code>my_taxmap$data$info$n_legs</code> or <code>n_legs</code> will have the same effect inside manipulation functions like <code>filter_taxa</code> described below. This is similar to how <code>taxon_ranks</code> was used in <code>supertaxa</code> in a previous section. To get the values of these variables, use <code>get_data</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">get_data</span>(my_taxmap)</a></code></pre></div>
<p>Note how “taxon_names” and “dangerous” are used below.</p>
<div id="filtering" class="section level4">
<h4>Filtering</h4>
<p>In addition to all of the functions like <code>subtaxa</code> that work with <code>taxonomy</code>, <code>taxmap</code> has a set of functions to manipulate data in a taxonomic context using functions based on <strong>dplyr</strong>. Like many operations on <code>taxmap</code> objects, there are a pair of functions that modify the taxa as well as the associated data, which we call “observations”. The <code>filter_taxa</code> and <code>filter_obs</code> functions are an example of such a pair that can filter taxa and observations respectively. For example, we can use <code>filter_taxa</code> to subset all taxa with a name starting with “t”:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">filter_taxa</span>(my_taxmap, <span class="kw">startsWith</span>(taxon_names, <span class="st">&quot;t&quot;</span>))</a></code></pre></div>
<p>There can be any number of filters that resolve to TRUE/FALSE vectors, taxon ids, or edge list indexes. For example, below is a combination of a TRUE/FALSE vectors and taxon id filter:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">filter_taxa</span>(my_taxmap, <span class="kw">startsWith</span>(taxon_names, <span class="st">&quot;t&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="st">&quot;o&quot;</span>))</a></code></pre></div>
<p>There are many options for <code>filter_taxa</code> that make it very flexible. For example, the <code>supertaxa</code> option can make all the supertaxa of selected taxa be preserved.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">filter_taxa</span>(my_taxmap, <span class="kw">startsWith</span>(taxon_names, <span class="st">&quot;t&quot;</span>), <span class="dt">supertaxa =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>The <code>filter_obs</code> function works in a similar way, but subsets observations in <code>my_taxmap$data</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">filter_obs</span>(my_taxmap, <span class="st">&quot;info&quot;</span>, dangerous <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>You can choose to filter out taxa whose observations did not pass the filter as well:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">filter_obs</span>(my_taxmap, <span class="st">&quot;info&quot;</span>, dangerous <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>, <span class="dt">drop_taxa =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Note how both the taxonomy and the associated data sets were filtered. The <code>drop_obs</code> option can be used to specify which non-target (i.e. not <code>&quot;info&quot;</code>) data sets are filtered when taxa are removed.</p>
</div>
<div id="sampling" class="section level4">
<h4>Sampling</h4>
<p>The functions <code>sample_n_obs</code> and <code>sample_n_taxa</code> are similar to <code>filter_obs</code> and <code>filter_taxa</code>, except taxa/observations are chosen randomly. All of the options of the “filter_” functions are available to the “sample_” functions</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="kw">sample_n_taxa</span>(my_taxmap, <span class="dv">3</span>) <span class="co"># &quot;3&quot; here is a taxon index in the edge list</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="kw">sample_n_taxa</span>(my_taxmap, <span class="dv">3</span>, <span class="dt">supertaxa =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="adding-columns" class="section level4">
<h4>Adding columns</h4>
<p>Adding columns to tabular data sets is done using <code>mutate_obs</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">mutate_obs</span>(my_taxmap, <span class="st">&quot;info&quot;</span>,</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">           <span class="dt">new_col =</span> <span class="st">&quot;Im new&quot;</span>,</a>
<a class="sourceLine" id="cb35-3" data-line-number="3">           <span class="dt">newer_col =</span> <span class="kw">paste0</span>(new_col, <span class="st">&quot;er!&quot;</span>))</a></code></pre></div>
<p>Note how you can use newly created columns in the same call.</p>
</div>
<div id="subsetting-columns" class="section level4">
<h4>Subsetting columns</h4>
<p>Subsetting columns in tabular data sets is done using <code>select_obs</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co"># Selecting a column by name</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="kw">select_obs</span>(my_taxmap, <span class="st">&quot;info&quot;</span>, dangerous)</a>
<a class="sourceLine" id="cb36-3" data-line-number="3"></a>
<a class="sourceLine" id="cb36-4" data-line-number="4"><span class="co"># Selecting a column by index</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5"><span class="kw">select_obs</span>(my_taxmap, <span class="st">&quot;info&quot;</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb36-6" data-line-number="6"></a>
<a class="sourceLine" id="cb36-7" data-line-number="7"><span class="co"># Selecting a column by regular expressions (i.e. TRUE/FALSE)</span></a>
<a class="sourceLine" id="cb36-8" data-line-number="8"><span class="kw">select_obs</span>(my_taxmap, <span class="st">&quot;info&quot;</span>, <span class="kw">matches</span>(<span class="st">&quot;^dange&quot;</span>))</a></code></pre></div>
</div>
<div id="sorting" class="section level4">
<h4>Sorting</h4>
<p>Sorting the edge list and observations is done using <code>arrage_taxa</code> and <code>arrange_obs</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">arrange_taxa</span>(my_taxmap, taxon_names)</a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="kw">arrange_obs</span>(my_taxmap, <span class="st">&quot;info&quot;</span>, name)</a></code></pre></div>
</div>
<div id="parsing-data" class="section level4">
<h4>Parsing data</h4>
<p>The <code>taxmap</code> class has the ability to contain and manipulate very complex data. However, this can make it difficult to parse the data into a <code>taxmap</code> object. For this reason, there are three functions to help creating <code>taxmap</code> objects from nearly any kind of data that a taxonomy can be associated with or derived from. The figure below shows simplified versions of how to create <code>taxmap</code> objects from different types of data in different formats.</p>
<p>The <code>parse_tax_data</code> and <code>lookup_tax_data</code> have, in addition to the functionality above, the ability to include additional data sets that are somehow associated with the source data sets (e.g. share a common identifier). Elements in these data sets will be assigned the taxa defined in the source data, so functions like <code>filter_taxa</code> and <code>filter_obs</code> will work on all of the data set at once. See the parsing vignette for more information.</p>
</div>
</div>
</div>
<div id="parsing-hierarchy-and-hierarchies-objects" class="section level2">
<h2>Parsing Hierarchy and hierarchies objects</h2>
<p>A set of functions are available for parsing objects of class <code>Hierarchy</code> and <code>hierarchies</code>. These functions are being ported from the CRAN package <code>binomen</code>.</p>
<p>The functions below are “taxonomically aware” so that you can use for example <code>&gt;</code> and <code>&lt;</code> operators to filter your taxonomic names data.</p>
<div id="pick" class="section level3">
<h3>pick</h3>
<p><code>pick()</code> - Pick out specific taxa, while others are dropped</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">ex_hierarchy1</a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="co"># specific ranks by rank name</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="kw">pick</span>(ex_hierarchy1, <span class="kw">ranks</span>(<span class="st">&quot;family&quot;</span>))</a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="co"># two elements by taxonomic name</span></a>
<a class="sourceLine" id="cb38-5" data-line-number="5"><span class="kw">pick</span>(ex_hierarchy1, <span class="kw">nms</span>(<span class="st">&quot;Poaceae&quot;</span>, <span class="st">&quot;Poa&quot;</span>))</a>
<a class="sourceLine" id="cb38-6" data-line-number="6"><span class="co"># two elements by taxonomic identifier</span></a>
<a class="sourceLine" id="cb38-7" data-line-number="7"><span class="kw">pick</span>(ex_hierarchy1, <span class="kw">ids</span>(<span class="dv">4479</span>, <span class="dv">4544</span>))</a>
<a class="sourceLine" id="cb38-8" data-line-number="8"><span class="co"># combine types</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9"><span class="kw">pick</span>(ex_hierarchy1, <span class="kw">ranks</span>(<span class="st">&quot;family&quot;</span>), <span class="kw">ids</span>(<span class="dv">4544</span>))</a></code></pre></div>
</div>
<div id="pop" class="section level3">
<h3>pop</h3>
<p><code>pop()</code> - Pop out taxa, that is, drop them</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">ex_hierarchy1</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="co"># specific ranks by rank name</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="kw">pop</span>(ex_hierarchy1, <span class="kw">ranks</span>(<span class="st">&quot;family&quot;</span>))</a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="co"># two elements by taxonomic name</span></a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="kw">pop</span>(ex_hierarchy1, <span class="kw">nms</span>(<span class="st">&quot;Poaceae&quot;</span>, <span class="st">&quot;Poa&quot;</span>))</a>
<a class="sourceLine" id="cb39-6" data-line-number="6"><span class="co"># two elements by taxonomic identifier</span></a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="kw">pop</span>(ex_hierarchy1, <span class="kw">ids</span>(<span class="dv">4479</span>, <span class="dv">4544</span>))</a>
<a class="sourceLine" id="cb39-8" data-line-number="8"><span class="co"># combine types</span></a>
<a class="sourceLine" id="cb39-9" data-line-number="9"><span class="kw">pop</span>(ex_hierarchy1, <span class="kw">ranks</span>(<span class="st">&quot;family&quot;</span>), <span class="kw">ids</span>(<span class="dv">4544</span>))</a></code></pre></div>
</div>
<div id="span" class="section level3">
<h3>span</h3>
<p><code>span()</code> - Select a range of taxa, either by two names, or relational operators</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">ex_hierarchy1</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="co"># keep all taxa between family and genus</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="co"># - by rank name, taxonomic name or ID</span></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="kw">span</span>(ex_hierarchy1, <span class="kw">nms</span>(<span class="st">&quot;Poaceae&quot;</span>, <span class="st">&quot;Poa&quot;</span>))</a>
<a class="sourceLine" id="cb40-5" data-line-number="5"></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="co"># keep all taxa greater than genus</span></a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="kw">span</span>(ex_hierarchy1, <span class="kw">ranks</span>(<span class="st">&quot;&gt; genus&quot;</span>))</a>
<a class="sourceLine" id="cb40-8" data-line-number="8"></a>
<a class="sourceLine" id="cb40-9" data-line-number="9"><span class="co"># keep all taxa greater than or equal to genus</span></a>
<a class="sourceLine" id="cb40-10" data-line-number="10"><span class="kw">span</span>(ex_hierarchy1, <span class="kw">ranks</span>(<span class="st">&quot;&gt;= genus&quot;</span>))</a>
<a class="sourceLine" id="cb40-11" data-line-number="11"></a>
<a class="sourceLine" id="cb40-12" data-line-number="12"><span class="co"># keep all taxa less than Felidae</span></a>
<a class="sourceLine" id="cb40-13" data-line-number="13"><span class="kw">span</span>(ex_hierarchy2, <span class="kw">nms</span>(<span class="st">&quot;&lt; Felidae&quot;</span>))</a>
<a class="sourceLine" id="cb40-14" data-line-number="14"></a>
<a class="sourceLine" id="cb40-15" data-line-number="15"><span class="co">## Multiple operator statements - useful with larger classifications</span></a>
<a class="sourceLine" id="cb40-16" data-line-number="16">ex_hierarchy3</a>
<a class="sourceLine" id="cb40-17" data-line-number="17"><span class="kw">span</span>(ex_hierarchy3, <span class="kw">ranks</span>(<span class="st">&quot;&gt; genus&quot;</span>), <span class="kw">ranks</span>(<span class="st">&quot;&lt; phylum&quot;</span>))</a></code></pre></div>
</div>
</div>
<div id="for-more-information" class="section level2">
<h2>For more information</h2>
<p>This vignette is meant to be just an outline of what <code>taxa</code> can do. In the future, we plan to release additional, in-depth vignettes for specific topics. More information for specific functions and examples can be found on their man pages by typing the name of the function prefixed by a <code>?</code> in an R session. For example, <code>?filter_taxa</code> will pull up the help page for <code>filter_taxa</code>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
